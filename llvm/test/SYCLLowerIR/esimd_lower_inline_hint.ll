; NOTE: Assertions have been autogenerated by utils/update_test_checks.py UTC_ARGS: --check-attributes
; RUN: opt -LowerESIMD -S < %s | FileCheck %s

; This test checks that LowerESIMD pass sets the 'alwaysinline'
; attribute for all the functions called from ESIMD kernels.

define spir_kernel void @EsimdKernel1() {
; CHECK-LABEL: @EsimdKernel1(
; CHECK-NEXT:    call void @foo()
; CHECK-NEXT:    call void @bar()
; CHECK-NEXT:    ret void
;
  call void @foo()
  call void @bar()
  ret void
}

define spir_kernel void @EsimdKernel2() {
; CHECK-LABEL: @EsimdKernel2(
; CHECK-NEXT:    call void @foobar()
; CHECK-NEXT:    ret void
;
  call void @foobar()
  ret void
}

define spir_func void @foo() {
; CHECK: Function Attrs: alwaysinline
; CHECK-LABEL: @foo(
; CHECK-NEXT:    ret void
;
  ret void
}

define spir_func void @bar() {
; CHECK: Function Attrs: alwaysinline
; CHECK-LABEL: @bar(
; CHECK-NEXT:    call void @foobar()
; CHECK-NEXT:    ret void
;
  call void @foobar()
  ret void
}

define spir_func void @foobar() {
; CHECK: Function Attrs: alwaysinline
; CHECK-LABEL: @foobar(
; CHECK-NEXT:    ret void
;
  ret void
}
